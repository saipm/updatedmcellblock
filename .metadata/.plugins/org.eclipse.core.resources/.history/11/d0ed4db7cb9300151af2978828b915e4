    package ngdemo.web.rest;  
      
    import java.io.IOException;  
    import java.io.PrintWriter;  
      
    import javax.servlet.RequestDispatcher;  
    import javax.servlet.ServletException;  
    import javax.servlet.http.HttpServlet;  
    import javax.servlet.http.HttpServletRequest;  
    import javax.servlet.http.HttpServletResponse;  
    import javax.servlet.http.HttpSession;

import net.tanesha.recaptcha.ReCaptchaImpl;
import net.tanesha.recaptcha.ReCaptchaResponse;  
      

      
    public class RegisterServlet extends HttpServlet{  
      
        private static final long serialVersionUID = 1L;  
      
        public void doPost(HttpServletRequest request, HttpServletResponse response)    
                throws ServletException, IOException {    
            System.out.println("inside registerservlet::::::::::::::");
            response.setContentType("text/html");   
            PrintWriter out = response.getWriter();   
            Boolean passwordcheck=false;
            String EMAIL_REGEX = "^[\\w-_\\.+]*[\\w-_\\.]\\@([\\w]+\\.)+[\\w]+[\\w]$";
            String email1 = request.getParameter("email");
            Boolean b = email1.matches(EMAIL_REGEX);
            System.out.println("is e-mail: "+email1+" :Valid = " + b);
   
            String strName = request.getParameter("username");
            String strPassword = request.getParameter("password1");
            String strConfirmPassword = request.getParameter("password2");
            if(strPassword.equals(strConfirmPassword))
            	passwordcheck=true;
         //   String strEmail = request.getParameter("email");
            
            String remoteAddr = request.getRemoteAddr();
    		ReCaptchaImpl reCaptcha = new ReCaptchaImpl();
    		reCaptcha.setPrivateKey("6LdlHOsSAAAAACe2WYaGCjU2sc95EZqCI9wLcLXY");

    		String challenge = request
    				.getParameter("recaptcha_challenge_field");
    		String uresponse = request.getParameter("recaptcha_response_field");
    		ReCaptchaResponse reCaptchaResponse = reCaptcha.checkAnswer(
    				remoteAddr, challenge, uresponse);
            System.out.println("value:::"+reCaptchaResponse.isValid());
    		if (reCaptchaResponse.isValid()) {
    			String user = request.getParameter("user");
    			//out.print("CAPTCHA Validation Success! User "+user+" registered.");
    		} else {
    			out.print("CAPTCHA Validation Failed! Try Again.");  
                RequestDispatcher rd=request.getRequestDispatcher("dummynew.html");    
                rd.include(request,response);
    		}
            
            String n=request.getParameter("username");    
            String p=request.getParameter("password");  
            HttpSession session = request.getSession(false);  
            if(session!=null)  
            session.setAttribute("name", n);  
      
            if(SigninDao.validate(n, p)){    
            	System.out.println("inside.....................");
                RequestDispatcher rd=request.getRequestDispatcher("dashboard.html");    
                rd.forward(request,response);    
            }    
            else{    
            	System.out.println("here:::::::::::::");
                out.print("<p style=\"color:red\">Sorry username or password error</p>");    
                RequestDispatcher rd=request.getRequestDispatcher("dummynew.html");    
                rd.include(request,response);    
            }    
      
            out.close();    
        }    
    }   